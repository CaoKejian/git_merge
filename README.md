# 使用场景

- 协同开发
- 需往公共分支上去合并自我分支、共同提测

# 使用方法
```sh
  1. 拷贝 merge.sh 文件到你的项目根目录, 随意命名 (A.sh)
  2. A.sh 添加到 .gitignore
  3. 打开终端（路径为项目根目录）
  4. chmod +x ./A.sh # 第一次使用需要，后边跳过直接执行第5步
  5. ./A.sh 或者 bash ./A.sh # 之后直接执行即可
```
# 功能流程介绍

1. **智能分支记忆**：自动缓存上次使用的目标分支，下次运行时询问是否复用
2. **安全合并流程**：完整执行 `checkout -> pull -> merge -> push` 的标准流程
3. **自动回退机制**：任何步骤出错立即停止并明确报错位置
4. **可视化提示**：使用彩色加粗文字区分不同操作状态

## 详细执行流程
1. **初始化检查**
   - 获取当前所在分支（失败报错）
   - 检查是否存在上次使用的目标分支缓存

2. **目标分支确认**
   - 有缓存时：询问是否复用上次分支（Y/n）
     - 选择Y/y或回车：使用缓存分支
     - 选择N/n：输入新分支并更新缓存
   - 无缓存时：直接要求输入目标分支并创建缓存

3. **分支验证**
   - 检查目标分支是否存在（失败报错）

4. **合并准备**
   - 切换到目标分支（失败报错）
   - 拉取目标分支最新代码（失败报错）

5. **核心合并**
   - 使用 `--no-ff` 方式合并当前分支（产生冲突时报错）
   - 推送合并结果到远程（失败报错）

6. **收尾工作**
   - 自动切换回原分支（失败报错）
   - 显示彩色成功提示

## 错误处理机制
| 错误场景 | 报错提示 | 解决方案 |
|---------|---------|---------|
| 获取当前分支失败 | "无法获取当前分支名称" | 检查git仓库是否正常 |
| 目标分支不存在 | "分支XXX不存在" | 确认分支名称或创建该分支 |
| 切换分支失败 | "无法切换到分支XXX" | 检查本地修改是否冲突 |
| 拉取代码失败 | "拉取分支XXX最新代码失败" | 检查网络或权限问题 |
| 合并冲突 | "合并出现冲突" | 手动解决冲突后重新合并 |
| 推送失败 | "推送代码到XXX失败" | 检查权限或网络连接 |
| 切换回原分支失败 | "无法切换回原分支" | 手动执行 `git checkout 原分支` |

## 注意事项
1. **缓存机制**：
   - 缓存文件路径：`/tmp/last_target_branch_项目名.txt`
   - 如需清除缓存，直接删除对应文件

2. **合并策略**：
   - 强制使用 `--no-ff` 保留合并记录
   - 合并前会自动拉取最新代码避免冲突

3. **最佳实践**：
   - 合并前确保本地分支已提交所有修改
   - 遇到冲突时优先使用 `git status` 查看冲突文件
   - 重要操作前建议手动备份分支
